apiVersion: v1
kind: ConfigMap
metadata:
  name: kafka-ssl-config
  namespace: confluent-kafka
data:
  server.properties: |
    # SSL配置
    ssl.keystore.location=/etc/kafka/secrets/kafka.server.keystore.jks
    ssl.keystore.password=password
    ssl.key.password=password
    ssl.truststore.location=/etc/kafka/secrets/kafka.server.truststore.jks
    ssl.truststore.password=password
    
    # 客户端认证
    ssl.client.auth=required
    ssl.endpoint.identification.algorithm=HTTPS
    
    # SSL协议配置
    ssl.enabled.protocols=TLSv1.2,TLSv1.3
    ssl.protocol=TLSv1.2
    ssl.provider=SunJSSE
    
    # 密码套件配置
    ssl.cipher.suites=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256
    
    # 安全随机数生成器
    ssl.secure.random.implementation=SHA1PRNG
  
  client.properties: |
    # 客户端SSL配置
    security.protocol=SSL
    ssl.truststore.location=/etc/kafka/secrets/kafka.server.truststore.jks
    ssl.truststore.password=password
    ssl.keystore.location=/etc/kafka/secrets/client.keystore.jks
    ssl.keystore.password=password
    ssl.key.password=password
    ssl.endpoint.identification.algorithm=HTTPS
    
    # 客户端配置
    bootstrap.servers=kafka-0.kafka-headless.confluent-kafka.svc.cluster.local:9093,kafka-1.kafka-headless.confluent-kafka.svc.cluster.local:9093,kafka-2.kafka-headless.confluent-kafka.svc.cluster.local:9093
    
    # 生产者配置
    acks=all
    retries=2147483647
    max.in.flight.requests.per.connection=5
    enable.idempotence=true
    compression.type=snappy
    
    # 消费者配置
    enable.auto.commit=false
    isolation.level=read_committed 